<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> C++使用libcurl上传文件代码示例 · HanDong's Blog</title><meta name="description" content="C++使用libcurl上传文件代码示例 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">C++使用libcurl上传文件代码示例</h1><div class="post-time">Jul 3, 2014</div><div class="post-content"><pre lang="cpp">
#include <stdio.h>
#include <iostream>
#include <string>

#define CURL_STATICLIB
#include "curl/curl.h"

//简单的post请求示例
void post_simple()
{
  /* get a curl handle */
  CURL *curl = curl_easy_init();
  if(curl) {
    /* First set the URL that is about to receive our POST. This URL can
       just as well be a https:// URL if that is what should receive the
       data. */
    curl_easy_setopt(curl, CURLOPT_PROXY, "172.18.172.251:80");
      curl_easy_setopt(curl, CURLOPT_URL, "http://radaronline.sinaapp.com/post.php?fa=po");
    /* Now specify the POST data */
    curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "name=daniel&project=curl");

    /* Perform the request, res will get the return code */
    CURLcode res = curl_easy_perform(curl);
    /* Check for errors */
    if(res != CURLE_OK)
      fprintf(stderr, "curl_easy_perform() failed: %s\n",
              curl_easy_strerror(res));

    /* always cleanup */
    curl_easy_cleanup(curl);
  }

}

//自定义处理函数 注册后libcurl将调用此函数处理接收到的数据
size_t write_data(void *buffer, size_t size, size_t nmemb, void *userp) {
    FILE *fptr = (FILE*)userp;
    fwrite(buffer, size, nmemb, fptr);

    printf("nmemb:%d, size:%d",nmemb, size);
    return nmemb*size;//必须返回实际处理的字节数 否则curl将认为处理失败
}

//自定义处理函数 简单演示将数据输出到控制台
size_t write_console(void *buffer, size_t size, size_t count, void *userp) {

    std::string str((const char*)buffer, size*count);

    std::cout<<str; return="" count*size;="" }="" 文件上传示例="" void="" post_file()="" {="" const="" char*="" posturl="http://radaronline.sinaapp.com/post.php?fa=po" ;="" filename="a.txt" file="" *fptr;="" if="" ((fptr="fopen(FILENAME," "w"))="=" null)="" for="" receive="" response="" data="" fprintf(stderr,="" "fopen="" error:="" %s\n",="" filename);="" exit(1);="" curl="" *curl="curl_easy_init();" curl_easy_setopt(curl,="" curlopt_proxy,="" "172.18.172.251:80");="" 设置代理="" 如不需要可注释此行="" 设置自定义处理函数="" 不设置时默认将接收到的数据输出到控制台="" curlopt_writefunction,="" write_console);="" 设置输出到文件的文件指针="" curlopt_writedata,="" fptr);="" curl_httppost="" *formpost="0," *lastptr="0;//指向表单链表的首尾" curl_formadd(&formpost,="" &lastptr,="" curlform_ptrname,="" "reqformat",="" curlform_ptrcontents,="" "plain",="" curlform_end);="" "file",="" curlform_file,="" "b.txt",="" curlopt_url,="" posturl);="" curlopt_httppost,="" formpost);="" 发送请求="" curlcode="" res="curl_easy_perform(curl);" curl_easy_cleanup(curl);="" int="" main(void)="" *="" in="" windows,="" this="" will="" init="" the="" winsock="" stuff="" curl_global_init(curl_global_all);="" post_file();="" curl_global_cleanup();="" 0;="" <="" pre=""></str;></string></iostream></stdio.h></pre></div></article></div></section><footer><div class="paginator"><a href="/2014/07/05/c-e4-bd-bf-e7-94-a8libbzip2-e8-a7-a3-e5-8e-8b-e6-96-87-e4-bb-b6-e4-bb-a3-e7-a0-81-e7-a4-ba-e4-be-8b/" class="prev">PRVE</a><a href="/2014/07/03/libcurl-e5-92-8clibbzip2-windows-e5-b9-b3-e5-8f-b0-e7-bc-96-e8-af-91-e5-92-8c-e4-bd-bf-e7-94-a8-e7-ac-94-e8-ae-b0/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>