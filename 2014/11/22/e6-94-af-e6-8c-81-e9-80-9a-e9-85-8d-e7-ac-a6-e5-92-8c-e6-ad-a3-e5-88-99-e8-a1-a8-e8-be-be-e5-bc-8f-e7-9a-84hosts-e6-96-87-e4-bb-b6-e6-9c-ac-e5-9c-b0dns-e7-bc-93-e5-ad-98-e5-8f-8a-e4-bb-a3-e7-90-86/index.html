<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 支持通配符和正则表达式的hosts文件(本地dns缓存及代理) · HanDong's Blog</title><meta name="description" content="支持通配符和正则表达式的hosts文件(本地dns缓存及代理) - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/html5-audio-player/" target="_self" class="nav-list-link">MUSIC</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">支持通配符和正则表达式的hosts文件(本地dns缓存及代理)</h1><div class="post-time">Nov 22, 2014</div><div class="post-content"><p>windows下的hosts文件可用来指定网址到ip的映射，而不用通过DNS服务器解析。某些情况下这是非常有用的，比如可防止某些域名被DNS污染，可加速常用网站的DNS查询，可屏蔽网站中大量的广告，但是windows自带的hosts文件功能较弱，编辑起来非常麻烦，不支持通配符，如果一个网站有大量二级或三级子域名，需要在hosts文件添加大量记录，如果这些子域名对应的ip改变，需要对大量记录进行修改，维护起来非常麻烦且容易出错。</p>
<p>有没有一个软件可以解决上面提到的问题？如果没有我就不写这篇文章了。今天要介绍的是 Acrylic(<a href="http://mayakron.altervista.org/wikibase/show.php?id=AcrylicHome" title="官方网站" target="_blank" rel="external">官网地址</a> / <a href="http://sourceforge.net/projects/acrylic/" title="项目地址" target="_blank" rel="external">开源项目地址</a>)。</p>
<p>Acrylic是一个本地DNS代理，比如以前你设置dns为8.8.8.8,现在你只需设置本机dns为127.0.0.1即可，然后配置Acrylic使用8.8.8.8。当你请求taobao.com时，Acrylic使用8.8.8.8解析taobao.com的ip，然后将这个ip缓存起来，下次再访问taobao.com时就从缓存中读取ip。</p>
<p>聪明的你可能知道windows本身是具有dns缓存功能的，各大浏览器也具有DNS缓存或DNS预解析功能，所以这不是本文章的重点。</p>
<p>先说一下安装，Acrylic使用Borland Delphi编写，只支持windows，可从官网下载安装文件，安装文件只有400KB，非常小巧。安装过程非常简单不再赘述。</p>
<p>安装完以后Acrylic会以windows服务的方式启动，默认Acrylic使用OpenDNS的地址208.67.222.222来解析，你也可手动修改安装目录下的AcrylicConfiguration.ini配置文件中的PrimaryServerAddress选项来修改为你想使用的DNS服务，比如google的8.8.8.8或阿里的223.5.5.5。</p>
<p>Acrylic安装目录下的AcrylicHosts.txt文件为Acrylic使用的Hosts文件，支持通配符*(匹配0或多个字符)和?(匹配0或一个字符)。并且支持一个ip对应多个地址。<br>比如下面这行代码将baidu的主域名和子域名全部解析到119.161.83.30这个地址。</p>
<pre lang="hosts">
 119.161.83.30 *.baidu.com baidu.com
</pre>

<p>AcrylicHosts.txt还支持正则表达式(以反斜杠开头的地址被当做正则表达式处理)，比如下面这行代码同样将baidu的主域名和子域名全部解析到119.161.83.30这个地址。</p>
<pre lang="hosts">
 119.161.83.30 /(\S+\.)?baidu.com
</pre>

<p>AcrylicHosts.txt还支持在通配符中排除指定子域名，比如下面这行代码将除pan.baidu.com之外的所有baidu的子域名解析到119.161.83.30这个地址。</p>
<pre lang="hosts">
 119.161.83.30 *.baidu.com baidu.com -pan.baidu.com
</pre>

<p>修改AcrylicHosts.txt之后记得清除Acrylic缓存并重启Acrylic服务，可通过开始菜单清除，或cmd–&gt;cd C:\Program Files\Acrylic DNS Proxy–&gt;AcrylicController.exe PurgeAcrylicCache</p>
<p>另外一定要记得将网络的DNS设置为127.0.0.1<br><a href="http://grow-wordpress.stor.sinaapp.com/uploads/2014/11/127.jpg" target="_blank" rel="external"><img src="http://grow-wordpress.stor.sinaapp.com/uploads/2014/11/127.jpg" alt="DNS设置"></a></p>
<p>在单位电脑做好以上配置后，是否可以让单位其他电脑共享你的配置呢，当然可以，Acrylic本来就是一个DNS代理。假设你的电脑IP为192.168.0.3，只需在其他电脑上将DNS配置为192.168.0.3即可。相当于一个单位内部DNS服务器。</p>
<p>AcrylicConfiguration.ini配置文件中还有一些其他的有用选项，比如控制哪些域名不进行缓存([CacheExceptionsSection]选项)，控制哪些电脑可以访问本DNS服务([AllowedAddressesSection]选项)。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/02/07/rtcmulticonnection-e6-ba-90-e7-a0-81-e5-88-86-e6-9e-90-e5-8f-8a-e7-a4-ba-e4-be-8b/" class="prev">上一篇</a><a href="/2014/10/25/asciimath-introduce/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>