<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> C++ 以POST方式向网页提交数据 · HanDong's Blog</title><meta name="description" content="C++ 以POST方式向网页提交数据 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">C++ 以POST方式向网页提交数据</h1><div class="post-time">Nov 10, 2011</div><div class="post-content"><p>示例代码如下：</p>
<pre lang="cpp">

#include <iostream>
#include <string>
#include <afxinet.h> //定义了MFC CInternetSession类等

bool PostHttpPage(const std::string& hostName, const std::string& pathName, const std::string& postData)
{
    using namespace std;

    CInternetSession session("your app agent name");

    try
    {
        INTERNET_PORT nPort = 80;
        DWORD dwRet = 0;

        CHttpConnection* pServer = session.GetHttpConnection(hostName.c_str(), nPort);
        CHttpFile* pFile = pServer->OpenRequest(CHttpConnection::HTTP_VERB_POST, pathName.c_str());

        CString strHeaders = "Content-Type: application/x-www-form-urlencoded"; // 请求头

        //开始发送请求

        pFile->SendRequest(strHeaders,(LPVOID)postData.c_str(),postData.size());
        pFile->QueryInfoStatusCode(dwRet);

        if (dwRet == HTTP_STATUS_OK)
        {
            CString result, newline;

            while(pFile->ReadString(newline))
            {//循环读取每行内容
                result += newline+"\r\n";
            }

            std::cout<<result<<std::endl; 显示返回内容="" }="" else="" {="" return="" false;="" delete="" pfile;="" pserver;="" catch="" (cinternetexception*="" pex)="" errors="" from="" wininet="" tchar="" pszerror[200];="" pex-="">GetErrorMessage(pszError, 200);

        std::cout<<pszerror<<std::endl; 显示异常信息="" return="" false;="" }="" session.close();="" true;="" int="" main(void)="" {="" 向http:="" current.sinaapp.com="" post.php发送数据="" posthttppage("current.sinaapp.com","post.php","name="rain&age=12");" <="" pre=""></pszerror<<std::endl;></result<<std::endl;></afxinet.h></string></iostream></pre></div></article></div></section><footer><div class="paginator"><a href="/2011/11/13/css-e7-bb-9d-e5-af-b9-e5-ae-9a-e4-bd-8d-e7-9a-84-e4-b8-80-e4-ba-9b-e8-a7-a3-e9-87-8a/" class="prev">上一篇</a><a href="/2011/11/10/c-e7-a8-8b-e5-ba-8f-e8-af-bb-e5-8f-96-e5-92-8c-e4-bf-9d-e5-ad-98-e9-85-8d-e7-bd-ae-e4-bf-a1-e6-81-af/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>