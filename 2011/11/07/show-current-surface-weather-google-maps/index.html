<!DOCTYPE html><html lang="zh-cn,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Google Maps 显示地面天气实况 · HanDong's Blog</title><meta name="description" content="Google Maps 显示地面天气实况 - HanDong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/html5-audio-player/" target="_self" class="nav-list-link">MUSIC</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Google Maps 显示地面天气实况</h1><div class="post-time">2011年11月7日</div><div class="post-content"><h2 id="一、用到的技术"><a href="#一、用到的技术" class="headerlink" title="一、用到的技术"></a>一、用到的技术</h2><ol>
<li>Google Maps API</li>
<li>jQuery &amp; jQuery UI &amp;jqPlot</li>
<li>canvas 绘制风速及UI</li>
<li>mysql 站点信息表 &amp; 站点-时间-观测数据 表 &amp;其他信息表(站点和数据最近更新时间、最新数据时间)</li>
<li>php返回json形式站点信息并在客户端持久存储</li>
<li>Ajax轮询请求获取最新数据</li>
<li>GeoLocation获取用户地理位置并定位</li>
<li>鼠标悬停站点时显示基本信息，点击detail时Ajax获取本站点最详尽信息</li>
<li>Javascript解析数据代码为天气信息，计算湿度和本站气压等</li>
<li>统计某一段时间数据(单站数据或多站对比)</li>
<li>C++ 自动监测处理(去掉站点经纬度高度等信息)地面图文件并post数据 &amp; 网页手动上传文件更新(提供基本上传和拖动上传方式)</li>
</ol>
<a id="more"></a>
<blockquote>
<p>地面填图文件示例：<a href="http://grow-wordpress.stor.sinaapp.com/uploads/2011/11/11110620.000.txt" target="_blank" rel="external">11110620.000</a></p>
</blockquote>
<h2 id="二、代码实现"><a href="#二、代码实现" class="headerlink" title="二、代码实现"></a>二、代码实现</h2><ol>
<li><p>创建站点数据表</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> station(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span> PRIMARY <span class="keyword">KEY</span> ,</span><br><span class="line">lon <span class="keyword">DOUBLE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">lat <span class="keyword">DOUBLE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">height <span class="keyword">DOUBLE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line"><span class="keyword">LEVEL</span> TINYINT <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">VARCHAR</span>( <span class="number">50</span> )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建地面观测数据表</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> surface(</span><br><span class="line">recordId <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line"> stationId <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> recordTime datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> totalCloudAmount <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> windDirection <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> windSpeed <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> seaLevelPressure <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> press3hour <span class="built_in">smallint</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> pastWeather1 <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> pastWeather2 <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> hour6precipitation <span class="keyword">double</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> lowCloudAmount <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> lowCloudShape <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> lowCloudHight <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> dewpoint <span class="keyword">double</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> visibility <span class="keyword">double</span> <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> presentWeather <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> temperature <span class="keyword">double</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> middleCloudShape <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> highCloudShape <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> transformT24 <span class="built_in">smallint</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> transformPress24 <span class="built_in">smallint</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> PRIMARY <span class="keyword">KEY</span> (recordId),</span><br><span class="line"> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> stationId (stationId,recordTime)</span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure>
<p> 每个月数据约100万行，可每个月建立一张表</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`surface201111`</span> <span class="keyword">LIKE</span> surface;</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据到station表</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update_stations</span><span class="params">($content)</span></span>&#123;</span><br><span class="line">	preg_match_all(<span class="string">'/^(\d&#123;5&#125;)\s+(-?\d+\.\d+)\s+(-?\d+\.\d+)\s+(-?\d+)\s+(\d+)/m'</span>,$content,$matchs,PREG_SET_ORDER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//print_r($matchs);</span></span><br><span class="line"></span><br><span class="line">	$sql = <span class="string">'INSERT IGNORE INTO station (id, lon, lat, height, level) VALUES '</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; count($matchs); $i++)&#123;</span><br><span class="line">		$sql .= <span class="string">'( '</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>($j = <span class="number">1</span>; $j &lt; <span class="number">5</span>; $j++)&#123;</span><br><span class="line">			$sql .= $matchs[$i][$j].<span class="string">","</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		$sql .= $matchs[$i][<span class="number">5</span>] .<span class="string">' )'</span>;</span><br><span class="line">		<span class="keyword">if</span>($i &lt; count($matchs) - <span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$sql .= <span class="string">','</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//echo $sql;</span></span><br><span class="line"></span><br><span class="line">	$mydb = <span class="keyword">new</span> DB(SAE_MYSQL_HOST_M);</span><br><span class="line">	<span class="keyword">return</span> $mydb -&gt; doSql($sql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据到surface表</p>
 <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSurfacePatten</span><span class="params">()</span></span>&#123;</span><br><span class="line">	$patten = <span class="string">'/^(\d&#123;5&#125;)(?:\s+-?\d+\.\d+)&#123;2&#125;(?:\s+-?\d+\s+\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(-?\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+(\d*\.\d+|\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+(-?\d*\.\d+|\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d*\.\d+|\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(-?\d*\.\d+|\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+\d+'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+\d+'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'\s+(-?\d+)'</span>;</span><br><span class="line">	$patten .= <span class="string">'\s+(-?\d+)'</span>;</span><br><span class="line"></span><br><span class="line">	$patten .= <span class="string">'/m'</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> $patten;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update_surface</span><span class="params">($content)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	preg_match(<span class="string">'/(\d+)\s+(0?\d+)\s+(0?\d+)\s+(0?\d+)\s+(\d+)\s*$/m'</span>,$content,$matchs);</span><br><span class="line"></span><br><span class="line">	$year = $matchs[<span class="number">1</span>] &gt; <span class="string">'50'</span> ? <span class="string">'19'</span>.$matchs[<span class="number">1</span>] : <span class="string">'20'</span>.$matchs[<span class="number">1</span>];</span><br><span class="line">	$timestr = $year.$matchs[<span class="number">2</span>].$matchs[<span class="number">3</span>].$matchs[<span class="number">4</span>].<span class="string">'0000'</span>;</span><br><span class="line"></span><br><span class="line">	$patten = getSurfacePatten();</span><br><span class="line"></span><br><span class="line">	preg_match_all($patten,$content,$matchs,PREG_SET_ORDER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//print_r($matchs);</span></span><br><span class="line"></span><br><span class="line">	$sql = <span class="string">'INSERT IGNORE INTO surface ('</span>;</span><br><span class="line">	$sql .= <span class="string">'recordTime,stationID,'</span>;</span><br><span class="line">	$sql .= <span class="string">'totalCloudAmount,windDirection,windSpeed,seaLevelPressure,press3hour,pastWeather1,pastWeather2,'</span>;</span><br><span class="line">	$sql .= <span class="string">'hour6precipitation,lowCloudAmount,lowCloudShape,lowCloudHight,'</span>;</span><br><span class="line">	$sql .= <span class="string">'dewpoint,visibility,presentWeather,temperature,'</span>;</span><br><span class="line">	$sql .= <span class="string">'middleCloudShape,highCloudShape,'</span>;</span><br><span class="line">	$sql .= <span class="string">'transformT24,transformPress24'</span>;</span><br><span class="line">	$sql .= <span class="string">' ) VALUES '</span>;</span><br><span class="line"></span><br><span class="line">	$mydb = <span class="keyword">new</span> DB(SAE_MYSQL_HOST_M);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; count($matchs); $i++)&#123;</span><br><span class="line">		$isexist = $mydb -&gt; rows_of_select(<span class="string">'select * from surface where stationId = '</span>.$matchs[$i][<span class="number">1</span>].<span class="string">' and recordTime = '</span>.$timestr);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>($isexist &gt; <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">		$sql .= <span class="string">'( '</span>;</span><br><span class="line">		$sql .= $timestr.<span class="string">","</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>($j = <span class="number">1</span>; $j &lt; <span class="number">20</span>; $j++)&#123;</span><br><span class="line">			$str = $matchs[$i][$j].<span class="string">","</span>;</span><br><span class="line">			$sql .= $str[<span class="number">0</span>] === <span class="string">'.'</span> ? <span class="string">'0'</span>.$str : $str;</span><br><span class="line">		&#125;</span><br><span class="line">		$sql .= $matchs[$i][<span class="number">20</span>] .<span class="string">' )'</span>;</span><br><span class="line">		<span class="keyword">if</span>($i &lt; count($matchs) - <span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$sql .= <span class="string">', '</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> $mydb -&gt; doSql($sql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新站点信息(站点名称)</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'顺义'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54398</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'海淀'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54399</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'延庆'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54406</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'佛爷顶'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54410</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'汤河口'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54412</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'密云'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54416</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'怀柔'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54419</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'密云上甸子'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54421</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'平谷'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54424</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'通州'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54431</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'朝阳'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54433</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'昌平'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54499</span>;</span><br><span class="line"><span class="keyword">update</span> station <span class="keyword">set</span> <span class="keyword">name</span> = <span class="string">'斋堂'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">54501</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据用户请求返回数据：</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>, lon, lat,</span><br><span class="line"><span class="keyword">LEVEL</span></span><br><span class="line"><span class="keyword">FROM</span> station</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">LEVEL</span> &lt;=<span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">sqrt</span>( lon * lon + lat * lat )</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>检查是否有重复数据</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> recordTime, stationId, <span class="keyword">count</span>( recordTime ) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`surface`</span></span><br><span class="line"><span class="keyword">WHERE</span> recordTime =<span class="number">20111111230000</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> stationId</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">500</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加唯一性约束条件</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">FROM</span> <span class="string">`surface`</span></span><br><span class="line"><span class="keyword">WHERE</span> stationId =<span class="number">99999</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> surface</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">unique</span> (stationId,recordTime);</span><br></pre></td></tr></table></figure>
</li>
</ol>
</div></article></div></section><footer><div class="paginator"><a href="/2011/11/08/jquery-1-7-e4-ba-8b-e4-bb-b6-e7-bb-91-e5-ae-9a-e5-87-bd-e6-95-b0/" class="prev">上一篇</a><a href="/2011/10/31/ncepdoe-reanalysis-ii/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">HanDong</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>