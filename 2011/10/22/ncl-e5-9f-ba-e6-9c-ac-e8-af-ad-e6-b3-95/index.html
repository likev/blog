<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> NCL语言基本语法 · HanDong's Blog</title><meta name="description" content="NCL语言基本语法 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">NCL语言基本语法</h1><div class="post-time">Oct 22, 2011</div><div class="post-content"><h3 id="一、数据类型"><a href="#一、数据类型" class="headerlink" title="一、数据类型"></a>一、数据类型</h3><p>1.<a href="http://www.ncl.ucar.edu/Document/Manuals/Ref_Manual/NclDataTypes.shtml#BasicNumericTypes" target="_blank" rel="external">数值类型</a>：<br><code>integer、uint、short、ushort、byte、ubyte、long、ulong、double</code><br>2.<a href="http://www.ncl.ucar.edu/Document/Manuals/Ref_Manual/NclDataTypes.shtml#Non-numericTypes" target="_blank" rel="external">非数值类型</a>：<br><code>logical、string、character、graphic、file、list</code></p>
<p>字符串(string)可以用双引号包围的一些字符生成（”This is an string”），和Javascript类似，字符串可以用加号(+)来连接。它本身不是数组，不可以用数组下标来获取子字符串，但是可以利用<a href="http://www.ncl.ucar.edu/Document/Functions/string.shtml" target="_blank" rel="external">一些函数</a>来操作和处理字符串。</p>
<h3 id="二、变量"><a href="#二、变量" class="headerlink" title="二、变量"></a>二、变量</h3><p>1.命名规则<br>和C语言一样，NCL语言中的变量名命名规则是：以字母或下划线开头的字母数字下划线组合。变量名区分大小写。</p>
<p>以下NCL关键字不可用于变量名：<br><code>begin        break        byte        character        continue        create        defaultapp        do        double        else        end        enumeric        external    False        file        float        function        getvalues        graphic        group        if        integer        int64        list        load        local        logical        long        new        _Missing        Missing        new        noparent        numeric        procedure        quit        QUIT        Quit        record        return        setvalues        short        snumeric        stop</code><br>2.定义和使用变量<br>NCL中的变量定义规则和Javascript语言相似：无需声明即可使用，其类型由其值决定。和Javascript变量相似的另一面是变量可以拥有属性。</p>
<pre lang="bash">
a = (/27.2, -10.0/)
a@_FillValue = -10.0
b = a * 9.0/5.0 + 32.0
print(b)
</pre>
3.变量维度

NCL中的多维数组使用 行 x 列 的方式储存，这点和C语言一致。按照约定，维度值为0 到 n-1，这里 n 是数据的维度。维度数值是有意义的，因为NCL允许将名称和维度进行关联。这样方便了坐标系下标操作和名称下标操作。变量维度以下列方式命名：
`temperature!0 = "frtime"
    temperature!1 = "lat"
    temperature!2 = "lon"
`

4.坐标变量

坐标变量是一些一维向量，并且和它们被指定的维度拥有相同的名称和大小。这些向量代表了每一个命名维度的数据坐标。如果这些向量中的值是单调递增或者递减，它们可以在坐标系下标操作中被使用。坐标变量定义如下：
`temperature&frtime = forecast_times
    temperature&lat = lat_points
    temperature&lon = lon_points
`

### 三、操作符和表达式

1.操作符和优先级如下
a.数值运算操作符
<table>
<tr><td>() 括号</td></tr>
<tr><td>- 取负(注意其优先级较高，和其他编程语言不同)</td></tr>
<tr><td>^ 乘方 数字的乘方或者数组的乘方 结果恒为浮点型，除非操作数为双精度型</td></tr>
<tr><td>
        *    乘

        /    除

        %    取模 两边的操作数必须均为整数

        #    矩阵乘法

</td></tr>
<tr><td>
        +    加 数值相加，如果两边是字符串，则连接两个字符串

        -    减

</td></tr>
<tr><td>
        &lt;    小于选择符(注意不是逻辑上的小于) arrayA &lt; arrayB 的结果为一个数组arrayC，arrayC[i]为arrayA[i]和arrayB[i]中较小的一个

        &gt;    大于选择符(注意不是逻辑上的大于) arrayA &gt; arrayB 的结果为一个数组arrayC，arrayC[i]为arrayA[i]和arrayB[i]中较大的一个

</td></tr>
</table>

b.逻辑操作符
<pre>
        .le.     小于等于(less-than-or-equal)
        .lt.    小于(less-than)
        .ge.    大于等于(greater-than-or-equal)
        .gt.    大于(greater-than)
        .ne.    不等于(not-equal)
        .eq.    等于(equal)
        .and.    且
        .xor.    亦或(exclusive-or)
        .or.    或
        .not.    非
</pre>

<p>c.数组操作符</p>
<p>数组操作符可以组合一组标量值或其他数组为新的数组。一个数组操作符由逗号(,)分割并用’(/‘ 和 ‘/)’ (称为数组设计符)包围。数组可以由任何基本类型或图形(graphical)对象组成，目前不支持文件数组。每一个被逗号分割的元素必须拥有相同的维度。如果元素类型不同，默认用<a href="http://www.ncl.ucar.edu/Document/Manuals/Ref_Manual/NclDataTypes.shtml#Coercion" target="_blank" rel="external">强制转换规则</a>将所有元素转换为相同的类型。</p>
<p>下面是一些数组操作符的例子：</p>
<pre><code>(/ 1, 2, 3, 4, 5 /)
(/ (/ 1, 2, 3 /)^2, (/ 4, 5, 6 /)^3,(/ 7, 8, 9 /)^4 /)
(/ a - b, b + c, c / d /)
</code></pre><p>d.数组下标操作<br>NCL中的数组下标操作和Fortran类似，除了下面几点不同：<br>i)NCL下标范围为[0,n-1]<br>ii)NCL中对于坐标变量(coordinate variables)的下标操作是对坐标变量中的数据进行操作<br>iii)命名的下标使用维度的名字以允许对数组重排序</p>
<p>下标操作示例：<br>`temperature(0,5,6)<br>temperature(1:3,5,6)<br>temperature(1:3,4:5,5:6)<br>temperature(0:4:2,0:5:3,0:6:4)<br>temperature(3:1,5,6)<br>temperature(3:1,4:5,5:6)<br>temperature(:2,:1,5:)<br>temperature(:,:,:)<br>temperature(:2:-1,:1:-1,5::-1)<br>temperature(::-1,::-1,::-1) 反转数组<br>temperature((/1,1,1,2,2,2,/),:,:) 使用向量作为第一个下标</p>
<p>坐标系下标操作<br>temperature(0,{20:60},{-95:-120})<br>temperature(0,{20},{-95})<br>temperature(0,{:20:2},{:-95:2})</p>
<p>名称下标操作<br>temperature( time | 0, lon | :, lat | : )<br>temperature( time | :, {lon | 20 : 60}, {lat | -95 : -120})<br>`</p>
<h3 id="四、NCL-语句"><a href="#四、NCL-语句" class="headerlink" title="四、NCL 语句"></a>四、NCL 语句</h3><p>1.块语句(Blocks)</p>
<p>块语句提供了一种将一系列命令分组的方式。<br><code>begin
        statement list
    end</code><br>当以加载脚本(loading scripts)或管道脚本(piping scripts)方式使用NCL时必须使用块语句</p>
<p>2.if 语句<br>`<br>if(scalar_logical_expression) then<br>    statement list<br>end if</p>
<p>if( scalar_logical_expression) then<br>    statement list<br>else<br>    statement list<br>end if<br><code>3.do 循环语句</code><br>        statement list<br>    end do </p>
<pre><code>do loop_identifier = scalar_start_expr , scalar_end_expr , scalar_stride_expr
    statement list
end do 
</code></pre><p><code>4.while 循环语句</code><br>do while (scalar_logical_expression)<br>    statement list<br>end do<br>`<br>5.赋值语句</p>
<p>‘-&gt;’、 ‘!’、 ‘&amp;’ 和 ‘@’ 构造符被用来指定文件变量声明、维度名称声明、坐标变量声明和属性声明。没有这些构造符时，将进行普通的值-变量 赋值。</p>
<p>6.函数语句</p>
<p>NCL中有两种可重用的代码片段：函数(Function)和过程(procedure)，这点和Fortran及Matlab语言类似。函数和过程有相似的定义语法，唯一的区别是function和procedure关键字。函数定义方法如下：<br><code>function function_name ( declaration_list )
    local local_identifier_list
    begin
        statement list
        return(return_value) 
    end</code></p>
<h3 id="五、NCL-输入输出-IO"><a href="#五、NCL-输入输出-IO" class="headerlink" title="五、NCL 输入输出(IO)"></a>五、NCL 输入输出(IO)</h3><p>1. 输入输出<a href="http://www.ncl.ucar.edu/Document/Manuals/Ref_Manual/NclFormatSupport.shtml" target="_blank" rel="external">支持格式</a>的文件<br><a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/addfile.shtml" target="_blank" rel="external">addfile</a></p>
<p>2. 输入输出ascii文件<br><a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/asciiread.shtml" target="_blank" rel="external">asciiread</a> <a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/asciiwrite.shtml" target="_blank" rel="external">asciiwrite</a></p>
<p>3.输入输出二维数组(矩阵)<br><a href="http://www.ncl.ucar.edu/Document/Functions/Built-in/write_matrix.shtml" target="_blank" rel="external">write_matrix</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2011/10/23/ncl-e5-87-bd-e6-95-b0-e5-8f-82-e8-80-83/" class="prev">上一篇</a><a href="/2011/10/21/ubuntu11-10-e7-8e-af-e5-a2-83-e4-b8-8b-e5-ae-89-e8-a3-85ncl-e8-bf-87-e7-a8-8b-e8-ae-b0-e5-bd-95/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>