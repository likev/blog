<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用PHP进行HTTP重定向 · HanDong's Blog</title><meta name="description" content="使用PHP进行HTTP重定向 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">使用PHP进行HTTP重定向</h1><div class="post-time">Feb 24, 2011</div><div class="post-content"><p>原文链接：<a href="http://yegle.net/2010/07/16/http-redirect-using-php/" target="_blank" rel="external">使用PHP进行HTTP重定向</a></p>
<p>在Google里搜“<a href="http://www.google.com/search?q=php+重定向" target="_blank" rel="external">PHP 重定向</a>”，<a href="http://yegle.net/2008/03/30/php-redirection/" target="_blank" rel="external">这篇日志</a>的排名在第四。但是这篇写得实在太烂了…重写一篇…</p>
<p>什么是HTTP重定向？</p>
<p>当你访问www.yegle.net时，地址栏的地址会自动变成yegle.net。当你访问ye.gl的时候，地址栏的地址会变成yegle.net。这就是HTTP重定向</p>
<p>一个HTTP请求，返回的HTTP Response Header里，第一行是HTTP的状态码。正常情况下，HTTP请求返回的状态码是200 OK。</p>
<p>正常的HTTP请求，返回200 OK：</p>
<p><pre lang="php">    &lt; HTTP/1.1 200 OK</pre></p>
<pre><code>&lt; Date: Fri, 16 Jul 2010 11:21:10 GMT

&lt; Server: Apache

&lt; X-Powered-By: PHP/5.2.4-2ubuntu5.10

&lt; Set-Cookie: PHPSESSID=7f86ed2e5a4750275e98971773ac88ab; path=/

&lt; Expires: Thu, 19 Nov 1981 08:52:00 GMT

&lt; Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0

&lt; Pragma: no-cache

&lt; Set-Cookie: wassup=ZjVjMWExMjZjNmIxNzU1NDBhZjU0MmM5MzhmYjllZDQ; expires=Fri, 16-Jul-2010 12:11:11 GMT; path=/

&lt; X-Pingback: http://yegle.net/xmlrpc.php

&lt; Vary: Accept-Encoding

&lt; Transfer-Encoding: chunked

&lt; Content-Type: text/html; charset=UTF-8

&lt;/pre&gt;
</code></pre><p>其他的比较知名的还有例如：</p>
<p><pre lang="php">    * 404 Not Found</pre></p>
<pre><code>* 301 Moved Permanently
* 302 Found
* 500 Internal Server Error&lt;/pre&gt;
</code></pre><p>HTTP重定向就是通过301和302两种状态码来实现的。</p>
<p>302是临时重定向的意思。表示被访问页面因为各种需要被临时跳转到其他页面。具体的例子是访问 <a href="http://yegle.net/recursion.php" target="_blank" rel="external">http://yegle.net/recursion.php</a></p>
<p><pre lang="php"><br>    &lt; HTTP/1.1 302 Found</pre></p>
<pre><code>&lt; Date: Fri, 16 Jul 2010 11:26:48 GMT

&lt; Server: Apache

&lt; X-Powered-By: PHP/5.2.4-2ubuntu5.10

&lt; Location: http://yegle.net/recursion.php

&lt; Cache-Control: max-age=600

&lt; Expires: Fri, 16 Jul 2010 11:36:48 GMT

&lt; Vary: Accept-Encoding

&lt; Content-Length: 0

&lt; Content-Type: text/html

&lt;/pre&gt;
</code></pre><p>浏览器在收到302 Found的状态码之后会在返回的HTTP Response Header中查找Location字段，然后访问对应地址。在这个例子中，浏览器就会访问 <a href="http://yegle.net/recursion.php" target="_blank" rel="external">http://yegle.net/recursion.php</a> (嗯这是一个递归，你懂的…)</p>
<p>301是永久重定向。这样的例子很好找。例如 <a href="http://google.com" target="_blank" rel="external">http://google.com</a></p>
<p><pre lang="php"><br>    &lt; HTTP/1.1 301 Moved Permanently</pre></p>
<pre><code>&lt; Location: http://www.google.com/

&lt; Content-Type: text/html; charset=UTF-8

&lt; Date: Fri, 16 Jul 2010 11:29:07 GMT

&lt; Expires: Sun, 15 Aug 2010 11:29:07 GMT

&lt; Cache-Control: public, max-age=2592000

&lt; Server: gws

&lt; Content-Length: 219

&lt; X-XSS-Protection: 1; mode=block
</code></pre><p><br>同样，浏览器在发现301的状态码之后会查找Location字段，然后访问那个地址。</p>
<p>Location字段的格式很随意，既可以是绝对地址，也可以是相对地址，还可以是相对根目录的地址。以下Location字段都是合法的：</p>
<p><pre lang="php"><br>Location: <a href="http://yegle.net/" target="_blank" rel="external">http://yegle.net/</a></pre></p>
<p>Location: /test/index.php</p>
<p>Location: index.php</p>
<p>Location: ../index.php<br><br>301重定向和302重定向在SEO以及缓存上是有非常大区别的。</p>
<p>对于SEO也就是搜索引擎优化，一个页面302重定向到另一个页面，新页面的PageRank不会受原页面影响。而一个页面301重定向到另一个页面，原页面的PageRank会被传递到新页面。所以对于一个网站进行域名转换，最好的方法就是使用301重定向，在经过一段时间之后可以不损失PR地将全站转移到新域名下。</p>
<p>对于HTTP代理服务器例如squid来说，如果一个页面是302重定向到新页面并且没有指定Expire HTTP头，squid将不缓存这个信息，也就是说每次用户通过代理请求时都会重新获取一遍。而对于301重定向，squid可以将结果缓存以便快速响应下一个请求相同页面的用户。</p>
<p>PHP里的302重定向非常简单，只要在返回的HTTP Response Header里添加Location字段，PHP将自动返回302状态码。例如：</p>
<p><pre lang="php"><br>header(“Location: <a href="http://yegle.net/recursion.php" target="_blank" rel="external">http://yegle.net/recursion.php</a>“);<br></pre><br>这段代码将自动重定向到<a href="http://yegle.net/recursion.php" target="_blank" rel="external">http://yegle.net/recursion.php</a></p>
<p>而301重定向则稍微有点复杂，需要直接将301状态码用header函数返回给用户。例如：</p>
<p><pre lang="php"><br>header( “HTTP/1.1 301 Moved Permanently” );<br>header( “Location: <a href="http://yegle.net/" target="_blank" rel="external">http://yegle.net/</a>“ );<br></pre><br>注意的是，跳转不是在收到response header的时候马上进行，也就是说页面的剩余内容会被下载来之后浏览器才会跳转。新手常犯的一个错误是，在逻辑判断时对符合条件的情况进行header跳转之后，忘了在之后加上exit()，导致错误。例如，用user_login()判断用户是否进行了登录，如果未登录则跳转到登录页面。代码如下：</p>
<p><pre lang="php"><br>if(!user_login()){<br>    header(“Location:login.php”);<br>}<br>//display contents for login users.<br></pre><br>这里，容易以为header之后这段代码就结束了，没有在header之后使用exit()。后面的代码继续被执行，导致未登录用户看到了已登录用户才能看到的内容。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2011/03/02/dom-e7-bb-93-e6-9e-84-e4-bb-a5-e5-8f-8ahtml-e4-b8-ad-e7-9a-84-e5-9f-ba-e6-9c-ac-e5-85-83-e7-b4-a0/" class="prev">PRVE</a><a href="/2011/02/21/e6-89-80-e6-82-9f-ef-bc-88-e4-b8-80-ef-bc-89/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>