<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> C++ 编码转换 多字节字符 宽字符 · HanDong's Blog</title><meta name="description" content="C++ 编码转换 多字节字符 宽字符 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">C++ 编码转换 多字节字符 宽字符</h1><div class="post-time">Jan 12, 2010</div><div class="post-content"><h2 id="C-中可用的字符编码总体上说有两种：-一种为多字节字符，-如Ansi编码，每个汉字由2个char-确定，或者utf-8编码，每个汉字由三个char-确定。另一种为宽字符编码，每个汉字直接由1个short-wchar-t-确定。"><a href="#C-中可用的字符编码总体上说有两种：-一种为多字节字符，-如Ansi编码，每个汉字由2个char-确定，或者utf-8编码，每个汉字由三个char-确定。另一种为宽字符编码，每个汉字直接由1个short-wchar-t-确定。" class="headerlink" title=" C++ 中可用的字符编码总体上说有两种： 一种为多字节字符， 如Ansi编码，每个汉字由2个char 确定，或者utf-8编码，每个汉字由三个char 确定。另一种为宽字符编码，每个汉字直接由1个short(wchar_t)确定。"></a><span style="color: #2b3cd3;"> C++ 中可用的字符编码总体上说有两种： 一种为多字节字符， 如Ansi编码，每个汉字由2个char 确定，或者utf-8编码，每个汉字由三个char 确定。另一种为宽字符编码，每个汉字直接由1个short(wchar_t)确定。</span></h2><h2 id="自己利用两个Win32-API函数写了两个用于编码转换的函数"><a href="#自己利用两个Win32-API函数写了两个用于编码转换的函数" class="headerlink" title="自己利用两个Win32 API函数写了两个用于编码转换的函数"></a><span style="color: #2b3cd3;">自己利用两个Win32 API函数写了两个用于编码转换的函数</span></h2><pre lang="cpp">
//编码转换

#include <string>

#include <windows.h>

//UTF8编码转换为Ansi编码
std::string & Utf8ToAnsi(std::string &scr, std::string &des)
{
    size_t n = scr.size()*2;
    wchar_t *sl = new wchar_t[n];

    char *sm = new char[n];
    //多字节(UTF8)编码转换为宽字节编码
    MultiByteToWideChar(CP_UTF8,0,scr.c_str(),-1,sl,n);

    //宽字节转换为多字节(Ansi)编码
    WideCharToMultiByte(CP_ACP, 0,sl, -1,sm, n,NULL,0);

    des = sm;
    delete []sl;
    delete []sm;

    return des;
}

//Ansi编码转换为Unicode(Utf16)编码
std::wstring & AnsiToUtf16(std::string &scr, std::wstring &des)
{
    size_t n = scr.size();

    wchar_t *sl = new wchar_t[n+1];

    MultiByteToWideChar(CP_ACP,0,scr.c_str(),-1,sl,n+1);

    des = sl;
    delete []sl;

    return des;
}
</windows.h></string></pre> </div></article></div></section><footer><div class="paginator"><a href="/2010/01/12/c-e5-91-bd-e5-90-8d-e7-a9-ba-e9-97-b4-e5-8f-98-e9-87-8f-e5-a3-b0-e6-98-8e-e5-ae-9a-e4-b9-89/" class="prev">PRVE</a><a href="/2009/12/19/cpp-e4-b8-ad-e5-a4-9a-e9-87-8d-else-if-e8-af-ad-e5-8f-a5-e7-9a-84-e7-ae-80-e5-8c-96/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>