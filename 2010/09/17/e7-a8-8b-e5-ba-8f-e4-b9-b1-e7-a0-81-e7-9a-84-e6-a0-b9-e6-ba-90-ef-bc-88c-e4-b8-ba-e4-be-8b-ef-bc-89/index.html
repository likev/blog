<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 程序乱码的根源（C++为例） · HanDong's Blog</title><meta name="description" content="程序乱码的根源（C++为例） - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">程序乱码的根源（C++为例）</h1><div class="post-time">Sep 17, 2010</div><div class="post-content"><p>当字符以某种编码（例如gbk）存储，但是以另一种编码（例如utf-8）显示时，乱码就产生了。</p>
<p>例如以下的C++源代码<br>//file1.cpp</p>
<pre lang="cpp">
#include <iostream>
int main()
{
char str[100]=&quot;abc完美&quot;;
std::cout&lt;&lt;str;
}
</iostream></pre>

<p>当编译链接后，程序在控制台（终端）一定会显示 abc完美 这几个字符么，不一定。</p>
<p>首先要看源代码file1.cpp是采用什么编码方式存储的，假如是GBK编码方式，则编译后生成的可执行文件中存储的是”abc完美”的GBK码。</p>
<p>其次要看系统的默认编码是什么，简体中文Windows的系统默认编码是GBK，Ubuntu 10的系统默认编码是UTF-8。当执行程序时，系统会用默认的编码显示字体。</p>
<p>具体来说，如果file1.cpp是用GBK编码方式，则字符串”abc完美”也将以GBK编码存储在可执行程序中，在简体中文Windows中运行程序时，系统将以默认的GBK编码解读字符串，于是正确显示字符串”abc完美”；但是当在Ubuntu 10中运行程序时，系统也将以默认的UTF-8编码解读字符串，由于用以存储和显示字符串的编码方式不一致，于是乱码产生了。</p>
<p>所以如果不考虑跨平带和国际化的话，源代码要以系统默认的编码方式存储，这样可以避免乱码的产生。对于初学者，这应该是比较简单实用的方式。</p>
<p>相关讨论</p>
<ol>
<li><a href="http://zadecn.spaces.live.com/blog/cns!85EE31844454E642!322.entry" target="_blank" rel="external">所见非所得-C++的代码编码(Encoding)</a></li>
</ol>
<p>2. <a href="http://zadecn.spaces.live.com/blog/cns%2185EE31844454E642%21323.entry" target="_blank" rel="external">避免在cpp源文件中出现静态的中文文字常量</a></p>
<p>3. <a href="http://zadecn.spaces.live.com/blog/cns!85EE31844454E642!353.entry" target="_blank" rel="external">字符集及字符的显示</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2010/09/17/e5-ad-97-e7-ac-a6-e7-bc-96-e7-a0-81-e7-9a-84-e8-bd-ac-e6-8d-a2-ef-bc-88c-e4-b8-ba-e4-be-8b-ef-bc-89/" class="prev">上一篇</a><a href="/2010/08/28/ubuntu-e5-ae-89-e8-a3-85-e5-b0-8f-e8-ae-b0/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>