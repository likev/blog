<!DOCTYPE html><html lang="zh-cn,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 字符编码的转换（C++为例） · HanDong's Blog</title><meta name="description" content="字符编码的转换（C++为例） - HanDong"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/html5-audio-player/" target="_self" class="nav-list-link">MUSIC</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">字符编码的转换（C++为例）</h1><div class="post-time">2010年9月17日</div><div class="post-content"><p>出处:<a href="http://www.cppblog.com/chemz/archive/2007/05/30/25133.html" title="http://www.cppblog.com/chemz/archive/2007/05/30/25133.html" target="_blank" rel="external">http://www.cppblog.com/chemz/archive/2007/05/30/25133.html</a></p>
<p>内容如下:</p>
<p>字符集相关问题<br>字符集目前有两个大的类别：本地字符集和国际字符集，其中每一类别的字符集又有多个<br>不同的字符编码实例。比如：本地字符集中基本上对于每一个不同的地区和国家就会形成一个<br>属于自己的字符集（ascii, latin-1, chs等），国际字符集中同样包括多种不同的编码方案<br>（utf8, utf16等）。<br>那么在C/C++程序中如何完成上述字符集之间的转换工作呢？分成两种情况：<br>1. 通过const char <em>cstr使用开发环境中的编辑器输入字符串常量”中国”，如下：<br>const char </em>cstr = “中国”;<br>这样一来cstr所指向的字符串内存中保存的则是本地字符编码下所形成的字符串，也<br>就是说，上面的cstr中存储着chs字符编码集中的字符；<br>2. 通过const wchar_t <em>wstr使用开发环境中的编辑器输入字符串常量”中国”，如下：<br>const wchar_t </em>wstr = L”中国”;<br>这样一来wstr所指向的字符串内存中保存的则是国际字符编码（在VC++下是ucs2，<br>在gcc下是ucs4）下所形成的字符串，也就是说，上面的wstr中存储着utf16字符编<br>码集中的字符；<br>那么如何将cstr转换成为wstr呢？可以通过C语言中的标准转换函数mbstowcs来完成该工<br>作，此时需要注意的是如果直接使用mbstowcs进行转换会得到一个错误的结果，并不能成功<br>的完成转换成为国际宽字符的要求，这是为什么呢？在C/C++语言标准中定义了其运行时的<br>字符集环境为”C”，也就是ASCII字符集的一个子集，那么mbstowcs在工作时会将cstr中所包<br>含的字符串看作是ASCII编码的字符，而不认为是一个包含有chs编码的字符串，所以他会将<br>每一个中文拆成2个ASCII编码进行转换，这样得到的结果就是会形成4个wchar_t的字符组成<br>的串，那么如何才能够让mbstowcs正常工作呢？在调用mbstowcs进行转换之间必须明确的告<br>诉mbstowcs目前cstr串中包含的是chs编码的字符串，通过setlocale( LC_ALL, “chs” )函数<br>调用来完成，需要注意的是这个函数会改变整个应用程序的字符集编码方式，必须要通过重<br>新调用setlocale( LC_ALL, “C” )函数来还原，这样就可以保证mbstowcs在转换时将cstr中<br>的串看作是中文串，并且转换成为2个wchar_t字符，而不是4个。</p>
</div></article></div></section><footer><div class="paginator"><a href="/2010/10/14/e4-bd-bf-e7-94-a8wxwidgets-e6-97-b6-e5-8f-91-e7-8e-b0-e7-9a-84-e4-b8-80-e4-ba-9bbug/" class="prev">上一篇</a><a href="/2010/09/17/e7-a8-8b-e5-ba-8f-e4-b9-b1-e7-a0-81-e7-9a-84-e6-a0-b9-e6-ba-90-ef-bc-88c-e4-b8-ba-e4-be-8b-ef-bc-89/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqitu.net">HanDong</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>