<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Boost中的Regex类库将部分中文识别为空白字符的问题原因及解决办法 · HanDong's Blog</title><meta name="description" content="Boost中的Regex类库将部分中文识别为空白字符的问题原因及解决办法 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Boost中的Regex类库将部分中文识别为空白字符的问题原因及解决办法</h1><div class="post-time">Mar 13, 2012</div><div class="post-content"><p>问题描述：<br>使用字符类\s匹配一个字符串中的空白字符时，部分中文字符也将被识别为空白。</p>
<p>原因：<br>查看Boost的Regex源代码可以发现，Regex使用cpp_regex_traits类(在文件 boost/regex/v4/cpp_regex_traits.hpp 中定义)来处理字符类</p>
<pre lang="cpp">
// class cpp_regex_traits_base:
// acts as a container for locale and the facets we are using.
//
template <class chart="">
struct cpp_regex_traits_base
{
   cpp_regex_traits_base(const std::locale& l)
   { imbue(l); }
   std::locale imbue(const std::locale& l);

   std::locale m_locale;
   std::ctype<chart> const* m_pctype; //这个类用来识别空白符
//……
}
</chart></class></pre>

<p>可以看到Regex使用<a href="http://www.cplusplus.com/reference/std/locale/ctype/" target="_blank" rel="external">std::ctype</a>类来识别空白符等<br>ctype类有一个<a href="http://www.cplusplus.com/reference/std/locale/ctype/is/" target="_blank" rel="external">is成员函数</a>用来判断某个字符是否属于空白字符或数字字符等，regex正是使用了这个成员函数。<br>查看这个成员函数的介绍可知字符类是在<a href="http://www.cplusplus.com/reference/clibrary/cctype/" target="_blank" rel="external">cctype</a>头文件中定义的<br>cctype头文件定义了一系列函数来分类和转换单个字符，函数isspace来判断一个字符是否为空白字符<br>再来看函数<a href="http://www.cplusplus.com/reference/clibrary/cctype/isspace/" target="_blank" rel="external">isspace</a>的说明，可知在C++中,指定了locale的此函数的模板版本存在于头文件<locale>中.<br>也就是说指定不同的locale，此函数的行为将不同。而默认的locale为”C” locale集。这就是问题的根源。</locale></p>
<p>解决办法：1.使用[ \t\r\n]等特定的字符来代替\s<br>2.设置合适的locale并使用宽字符集和Regex的宽字符版本wregex</p>
</div></article></div></section><footer><div class="paginator"><a href="/2012/03/25/c-e5-ad-97-e7-ac-a6-e4-b8-b2-e5-ad-97-e9-9d-a2-e5-80-bc-e7-9a-84-e4-bd-bf-e7-94-a8/" class="prev">PRVE</a><a href="/2012/03/07/windows-e4-b8-8b-e7-bc-96-e8-af-91-e5-92-8c-e5-ae-89-e8-a3-85boost-e5-ba-93/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>