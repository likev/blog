<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> C++跨平台开源库POCO学习笔记 · HanDong's Blog</title><meta name="description" content="C++跨平台开源库POCO学习笔记 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/html5-audio-player/" target="_self" class="nav-list-link">MUSIC</a></li><li class="nav-list-item"><a href="https://twitter.com/likev" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/likev" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">C++跨平台开源库POCO学习笔记</h1><div class="post-time">Dec 20, 2012</div><div class="post-content"><p>POCO(<a href="http://pocoproject.org/" title="POCO官方网站" target="_blank" rel="external">pocoproject.org</a>)看起来是很不错的C++跨平台开源库，包含网络(HTTP、FTP等)、正则、XML、Zip、日期、文件、线程、通知、配置、日志、Timer等方面的类，只可惜国内使用者和讨论很少。</p>
<h3 id="一、编译安装方法"><a href="#一、编译安装方法" class="headerlink" title="一、编译安装方法"></a>一、编译安装方法</h3><ol>
<li>从官网(<a href="http://pocoproject.org/download/index.html" title="点击进入官网下载" target="_blank" rel="external">pocoproject.org/download</a>)下载POCO源代码，推荐下载基本版本(Basic Edition)</li>
<li><p>POCO由基础(Foundation)、有用工具(Util)、网络(Net)、XML等几大模块组成，源代码中每个模块为一个单独的目录，包含本模块的include文件、源代码(src)、例子(samples)和测试样本(testsuite)。</p>
</li>
<li><p>windows平台下推荐通过VS命令工具进行编译，具体操作为从开始–打开VS命令工具–进入poco源代码目录–输入buildwin查看具体用法。可选择生成3种不同的库(static_mt|static_md|shared|all)，还可选择生成release或debug版本，推荐生成release的static_mt版本，这样生成的程序可以直接发布。具体说明可参加官方文档中的说明(<a href="http://pocoproject.org/docs/" title="打开POCO官方文档" target="_blank" rel="external">pocoproject.org/docs</a>)。</p>
<p> 也可直接进入poco-1.4.6p4\Foundation 等源代码目录，打开sln文件(visual C++解决方案文件)，然后编译生成库文件，效果和前者相同(其实前者也是调用相应的sln文件)</p>
<p> 生成的库文件在源代码目录下的lib文件夹中</p>
</li>
<li><p>可将各个不同模块下的include目录放在一起方便随后程序使用，像我这样<br><a href="http://grow-wordpress.stor.sinaapp.com/uploads/2012/12/poco.jpg" target="_blank" rel="external"><img src="http://grow-wordpress.stor.sinaapp.com/uploads/2012/12/poco.jpg" alt="" title="poco include目录"></a></p>
</li>
</ol>
<h3 id="二、如何使用呢–以免费的Visual-C-2010-Express版本为例"><a href="#二、如何使用呢–以免费的Visual-C-2010-Express版本为例" class="headerlink" title="二、如何使用呢–以免费的Visual C++ 2010 Express版本为例"></a>二、如何使用呢–以免费的Visual C++ 2010 Express版本为例</h3><ol>
<li><p>首先新建一个项目，添加一个C++源文件，点击Visual C++菜单栏的项目-属性打开属性页，点击 配置属性-C/C++-常规 在右边的附件包含目录里填入Poco的include文件所在目录。点击 配置属性-链接器-常规 在右边的附加库目录里填入Poco lib库或dll库所在的目录</p>
</li>
<li><p>默认情况下Poco可自动链接生成的dll库，<del>如果想让它自动链接静态lib库，请点击 配置属性-C/C++-预处理器 在右边的预处理器定义中添加 POCO_STATIC，</del>最新版也可直接链接静态库。进一步了解请参考官方文档。</p>
</li>
<li><p>Poco使用了C++的命名空间和异常机制，请记得处理异常哦，否则程序可能会崩溃的。Poco::Exception是所有Poco异常类的基类，如果你不知道具体的异常类型，可使用下面的方式捕获所有异常信息：</p>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt; dirs;</span><br><span class="line">	getDirList(dirs);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>; i&lt;dirs.size(); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"deal dir "</span>&lt;&lt;dirs[i]&lt;&lt;<span class="string">"....\n"</span>;</span><br><span class="line">		pocoFtp1(dirs[i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(Poco::Exception &amp;exc)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"exc"</span>&lt;&lt;exc.displayText();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="三、利用POCO进行HTTP-POST请求的例子"><a href="#三、利用POCO进行HTTP-POST请求的例子" class="headerlink" title="三、利用POCO进行HTTP POST请求的例子"></a>三、利用POCO进行HTTP POST请求的例子</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;iostream&gt;</span><br><span class="line">#include "Poco/Net/HTMLForm.h"</span><br><span class="line">#include "Poco/URI.h"</span><br><span class="line">#include "Poco/Net/HTTPClientSession.h"</span><br><span class="line">#include "Poco/Net/HTTPRequest.h"</span><br><span class="line">#include "Poco/Net/HTTPResponse.h"</span><br><span class="line">#include "Poco/StreamCopier.h"</span><br><span class="line">#include "Poco/Net/NetException.h"</span><br><span class="line"></span><br><span class="line">//可用下面数据测试</span><br><span class="line">//url http://current.sinaapp.com/post.php</span><br><span class="line">//key abc</span><br><span class="line">//value 456</span><br><span class="line"></span><br><span class="line">//向网页提交post请求</span><br><span class="line">void pocoPost(const std::string &amp;url, const std::string &amp;key, const std::string &amp;value)</span><br><span class="line">&#123;</span><br><span class="line">	Poco::URI purl(url);</span><br><span class="line"></span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		Poco::Net::HTTPClientSession session( purl.getHost(), purl.getPort() );</span><br><span class="line">//如需设置代理 将下面一句注释去掉		</span><br><span class="line">//session.setProxy("172.18.172.251",80);</span><br><span class="line"></span><br><span class="line">		Poco::Net::HTTPRequest req(Poco::Net::HTTPRequest::HTTP_POST, purl.getPath(), Poco::Net::HTTPMessage::HTTP_1_1);</span><br><span class="line"></span><br><span class="line">		Poco::Net::HTMLForm form;</span><br><span class="line">		form.add(key, value);</span><br><span class="line"></span><br><span class="line">		// Send the request.</span><br><span class="line">		form.prepareSubmit(req);</span><br><span class="line">		std::ostream&amp; ostr = session.sendRequest(req);</span><br><span class="line">		form.write(ostr);//提交post的键值信息</span><br><span class="line"></span><br><span class="line">		Poco::Net::HTTPResponse res;</span><br><span class="line"></span><br><span class="line">		std::istream&amp; istr = session.receiveResponse(res);</span><br><span class="line">//上句接收网站回应的信息 返回输入流 并copy到标准控制台输出流</span><br><span class="line">		Poco::StreamCopier::copyStream(istr, std::cout);</span><br><span class="line">		std::cout&lt;&lt;std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">	catch(Poco::Net::NetException&amp; ex)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout&lt;&lt;"post wrong: "&lt;&lt;ex.displayText();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="四、利用POCO操作FTP的例子"><a href="#四、利用POCO操作FTP的例子" class="headerlink" title="四、利用POCO操作FTP的例子"></a>四、利用POCO操作FTP的例子</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"Poco/Net/FTPClientSession.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"Poco/StreamCopier.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pocoFtp</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;host,<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;username,<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;password,<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;dir)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	Poco::Net::<span class="function">FTPClientSession <span class="title">session</span><span class="params">(host)</span></span>;</span><br><span class="line">	session.login(username, password);<span class="comment">//登录</span></span><br><span class="line"></span><br><span class="line">	session.setWorkingDirectory(dir);<span class="comment">//设置读取目录</span></span><br><span class="line">	<span class="built_in">std</span>::istream &amp;ftpin = session.beginList(<span class="string">""</span>);<span class="comment">//下载目录中文件列表</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">string</span> str;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span> &gt; filelist;</span><br><span class="line">	<span class="keyword">while</span>(ftpin&gt;&gt;str)</span><br><span class="line">	&#123;<span class="comment">//存储文件列表</span></span><br><span class="line">		filelist.push_back(str);</span><br><span class="line">	&#125;</span><br><span class="line">	session.endList();<span class="comment">//关闭目录下载连接</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>; i!=filelist.size(); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">"deal file "</span>&lt;&lt;filelist[i]&lt;&lt;<span class="string">"...\n"</span>;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">string</span> content;</span><br><span class="line"><span class="comment">//下载每个文件并存储到字符串content中</span></span><br><span class="line">		Poco::StreamCopier::copyToString( session.beginDownload( filelist[i] ), content);</span><br><span class="line">		session.endDownload();<span class="comment">//关闭下载连接</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	session.close();<span class="comment">//断开FTP</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="五、利用POCO读写XML配置文件的例子"><a href="#五、利用POCO读写XML配置文件的例子" class="headerlink" title="五、利用POCO读写XML配置文件的例子"></a>五、利用POCO读写XML配置文件的例子</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="string">"Poco/Util/XMLConfiguration.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pocoConfig</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">using</span> Poco::AutoPtr;</span><br><span class="line">	<span class="keyword">using</span> Poco::Util::XMLConfiguration;</span><br><span class="line"></span><br><span class="line">	AutoPtr&lt;XMLConfiguration&gt; pConf(<span class="keyword">new</span> XMLConfiguration(<span class="string">"config1.xml"</span>) );</span><br><span class="line"></span><br><span class="line">	pConf-&gt;setDouble(<span class="string">"prop6"</span>,<span class="number">3.14</span>);</span><br><span class="line">	<span class="keyword">double</span> a = pConf-&gt;getDouble(<span class="string">"prop2"</span>);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;a;</span><br><span class="line">	pConf-&gt;save(<span class="string">"config1.xml"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml配置文件格式如下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">prop2</span>&gt;</span>2.3<span class="tag">&lt;/<span class="name">prop2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>相关资源：</p>
<blockquote>
<ol>
<li><a href="http://sdrv.ms/10E2YNR" title="点击查看" target="_blank">POCO官方幻灯片教程整理</a></li>
<li><a href="http://pocoproject.org/docs/" title="点击查看" target="_blank" rel="external">POCO官方文档说明</a></li>
</ol>
</blockquote>
</div></article></div></section><footer><div class="paginator"><a href="/2013/01/09/bing-background-image-api/" class="prev">PRVE</a><a href="/2012/12/20/scilab-windows-e5-b9-b3-e5-8f-b0-e4-b8-8bmatlab-e7-9a-84-e5-85-8d-e8-b4-b9-e5-bc-80-e6-ba-90-e6-9b-bf-e4-bb-a3-e8-80-85/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>