<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> C++跨平台开源库POCO学习笔记 · HanDong's Blog</title><meta name="description" content="C++跨平台开源库POCO学习笔记 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">C++跨平台开源库POCO学习笔记</h1><div class="post-time">Dec 20, 2012</div><div class="post-content"><p>POCO(<a href="http://pocoproject.org/" title="POCO官方网站" target="_blank" rel="external">pocoproject.org</a>)看起来是很不错的C++跨平台开源库，包含网络(HTTP、FTP等)、正则、XML、Zip、日期、文件、线程、通知、配置、日志、Timer等方面的类，只可惜国内使用者和讨论很少。</p>
<div><br><br>### 一、编译安装方法<br><br>1.  从官网(<a href="http://pocoproject.org/download/index.html" title="点击进入官网下载" target="_blank" rel="external">pocoproject.org/download</a>)下载POCO源代码，推荐下载基本版本(Basic Edition)<br>2.  POCO由基础(Foundation)、有用工具(Util)、网络(Net)、XML等几大模块组成，源代码中每个模块为一个单独的目录，包含本模块的include文件、源代码(src)、例子(samples)和测试样本(testsuite)。<br><br>3.  windows平台下推荐通过VS命令工具进行编译，具体操作为从开始–打开VS命令工具–进入poco源代码目录–输入buildwin查看具体用法。可选择生成3种不同的库(static_mt|static_md|shared|all)，还可选择生成release或debug版本，推荐生成release的static_mt版本，这样生成的程序可以直接发布。具体说明可参加官方文档中的说明(<a href="http://pocoproject.org/docs/" title="打开POCO官方文档" target="_blank" rel="external">pocoproject.org/docs</a>)。<br><br>也可直接进入poco-1.4.6p4\Foundation 等源代码目录，打开sln文件(visual C++解决方案文件)，然后编译生成库文件，效果和前者相同(其实前者也是调用相应的sln文件)<br><br>生成的库文件在源代码目录下的lib文件夹中<br><br>4.  可将各个不同模块下的include目录放在一起方便随后程序使用，像我这样<br><a href="http://grow-wordpress.stor.sinaapp.com/uploads/2012/12/poco.jpg" target="_blank" rel="external"><img src="http://grow-wordpress.stor.sinaapp.com/uploads/2012/12/poco.jpg" alt="" title="poco include目录"></a><br></div>

<div><br><br>### 二、如何使用呢–以免费的Visual C++ 2010 Express版本为例<br><br>1.  首先新建一个项目，添加一个C++源文件，点击Visual C++菜单栏的项目-属性打开属性页，点击 配置属性-C/C++-常规 在右边的附件包含目录里填入Poco的include文件所在目录。点击 配置属性-链接器-常规 在右边的附加库目录里填入Poco lib库或dll库所在的目录<br>2.  默认情况下Poco可自动链接生成的dll库，<del>如果想让它自动链接静态lib库，请点击 配置属性-C/C++-预处理器 在右边的预处理器定义中添加 POCO_STATIC，</del>最新版也可直接链接静态库。进一步了解请参考官方文档。<br>3.  Poco使用了C++的命名空间和异常机制，请记得处理异常哦，否则程序可能会崩溃的。Poco::Exception是所有Poco异常类的基类，如果你不知道具体的异常类型，可使用下面的方式捕获所有异常信息：<br><pre lang="cpp"><br>try<br>{<br>    std::vector<std::string> dirs;<br>    getDirList(dirs);<br><br>    for(size_t i=0; i<dirs.size(); i++)="" {="" std::cout<<"deal="" dir="" "<<dirs[i]<<"....\n";="" pocoftp1(dirs[i]);="" }="" catch(poco::exception="" &exc)="" std::cout<<"exc"<<exc.displaytext();="" <="" pre=""><br></dirs.size();></std::string></pre></div>

<h3 id="三、利用POCO进行HTTP-POST请求的例子"><a href="#三、利用POCO进行HTTP-POST请求的例子" class="headerlink" title="三、利用POCO进行HTTP POST请求的例子"></a>三、利用POCO进行HTTP POST请求的例子</h3><pre lang="cpp">
#include<iostream>
#include "Poco/Net/HTMLForm.h"
#include "Poco/URI.h"
#include "Poco/Net/HTTPClientSession.h"
#include "Poco/Net/HTTPRequest.h"
#include "Poco/Net/HTTPResponse.h"
#include "Poco/StreamCopier.h"
#include "Poco/Net/NetException.h"

//可用下面数据测试
//url http://current.sinaapp.com/post.php
//key abc
//value 456

//向网页提交post请求
void pocoPost(const std::string &url, const std::string &key, const std::string &value)
{
    Poco::URI purl(url);

    try
    {
        Poco::Net::HTTPClientSession session( purl.getHost(), purl.getPort() );
//如需设置代理 将下面一句注释去掉        
//session.setProxy("172.18.172.251",80);

        Poco::Net::HTTPRequest req(Poco::Net::HTTPRequest::HTTP_POST, purl.getPath(), Poco::Net::HTTPMessage::HTTP_1_1);

        Poco::Net::HTMLForm form;
        form.add(key, value);

        // Send the request.
        form.prepareSubmit(req);
        std::ostream& ostr = session.sendRequest(req);
        form.write(ostr);//提交post的键值信息

        Poco::Net::HTTPResponse res;

        std::istream& istr = session.receiveResponse(res);
//上句接收网站回应的信息 返回输入流 并copy到标准控制台输出流
        Poco::StreamCopier::copyStream(istr, std::cout);
        std::cout<<std::endl; }="" catch(poco::net::netexception&="" ex)="" {="" std::cout<<"post="" wrong:="" "<<ex.displaytext();="" <="" pre="">

<h3 id="四、利用POCO操作FTP的例子"><a href="#四、利用POCO操作FTP的例子" class="headerlink" title="四、利用POCO操作FTP的例子"></a>四、利用POCO操作FTP的例子</h3><pre lang="cpp">
#include "Poco/Net/FTPClientSession.h"
#include "Poco/StreamCopier.h"

#include <iostream>
#include <vector>
#include <sstream>

void pocoFtp(const std::string &host,const std::string &username,const std::string &password,const std::string &dir)
{
    Poco::Net::FTPClientSession session(host);
    session.login(username, password);//登录

    session.setWorkingDirectory(dir);//设置读取目录
    std::istream &ftpin = session.beginList("");//下载目录中文件列表

    std::string str;
    std::vector<std::string> filelist;
    while(ftpin>>str)
    {//存储文件列表
        filelist.push_back(str);
    }
    session.endList();//关闭目录下载连接

    for(size_t i=0; i!=filelist.size(); i++)
    {
        std::cout<<"deal file="" "<<filelist[i]<<"...\n";="" std::string="" content;="" 下载每个文件并存储到字符串content中="" poco::streamcopier::copytostring(="" session.begindownload(="" filelist[i]="" ),="" content);="" session.enddownload();="" 关闭下载连接="" }="" session.close();="" 断开ftp="" <="" pre="">

<h3 id="五、利用POCO读写XML配置文件的例子"><a href="#五、利用POCO读写XML配置文件的例子" class="headerlink" title="五、利用POCO读写XML配置文件的例子"></a>五、利用POCO读写XML配置文件的例子</h3><pre lang="cpp">
#include "Poco/Util/XMLConfiguration.h"
#include <string>
#include <iostream>

void pocoConfig()
{
    using Poco::AutoPtr;
    using Poco::Util::XMLConfiguration;

    AutoPtr<xmlconfiguration> pConf(new XMLConfiguration("config1.xml") );

    pConf->setDouble("prop6",3.14);
    double a = pConf->getDouble("prop2");
    std::cout<<a; pconf-="">save("config1.xml");
}
</a;></xmlconfiguration></iostream></string></pre>

<p>xml配置文件格式如下</p>
<pre lang="cpp">
<config>
    <prop2>2.3</prop2>
</config>
</pre>

<div><br>相关资源：<br>1. <a href="http://sdrv.ms/10E2YNR" title="点击查看" target="_blank">POCO官方幻灯片教程整理</a><br>2. <a href="http://pocoproject.org/docs/" title="点击查看" target="_blank" rel="external">POCO官方文档说明</a><br></div></"deal></std::string></sstream></vector></iostream></pre></std::endl;></iostream></pre></div></article></div></section><footer><div class="paginator"><a href="/2013/01/09/e5-bf-85-e5-ba-94cn-bing-com-e9-a6-96-e9-a1-b5-e8-83-8c-e6-99-af-e5-9b-be-e7-89-87-e8-b0-83-e7-94-a8-e6-8e-a5-e5-8f-a3/" class="prev">PRVE</a><a href="/2012/12/20/scilab-windows-e5-b9-b3-e5-8f-b0-e4-b8-8bmatlab-e7-9a-84-e5-85-8d-e8-b4-b9-e5-bc-80-e6-ba-90-e6-9b-bf-e4-bb-a3-e8-80-85/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2016 <a href="http://blog.tianqi.at">John Doe</a>, unless otherwise noted.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>